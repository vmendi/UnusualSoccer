<?xml version="1.0" encoding="utf-8"?>
<s:Group xmlns:fx="http://ns.adobe.com/mxml/2009" 
		 xmlns:s="library://ns.adobe.com/flex/spark" 
		 xmlns:mx="library://ns.adobe.com/flex/mx" visible="{IsInjured(TheSoccerPlayer)}"
		 creationComplete="CreationCompleteHandler(event)">
	
	<fx:Style source="../styles.css" />
	
	<fx:Script><![CDATA[
		import GameModel.SoccerPlayerDerived;
		
		import SoccerServer.TransferModel.vo.SoccerPlayer;
		
		import mx.events.FlexEvent;
		
		import utils.TimeUtils;
		
		[Bindable]
		public function get TheSoccerPlayer() : SoccerPlayer { return mSoccerPlayer; }
		public function set TheSoccerPlayer(v:SoccerPlayer) : void { mSoccerPlayer = v; }
		private var mSoccerPlayer : SoccerPlayer;
		
		static private function IsInjured(soccerPlayer : SoccerPlayer) : Boolean
		{
			return soccerPlayer != null && soccerPlayer.IsInjured;
		}
		
		static private function GetInjuryRemainingTime(soccerPlayer : SoccerPlayer) : String
		{
			var ret : String = "";
			
			if (IsInjured(soccerPlayer))
			{
				var remainingMilisecs : Number = (soccerPlayer.LastInjuryDate.time + (2*24*60*60*1000)) - new Date().time;
				
				// Seguro que la lesion no ha caducado?
				if (remainingMilisecs >=0)
				{
					ret = TimeUtils.ConvertSecondsToStringVerbose(remainingMilisecs / 1000);
				}
			}
			
			return ret;
		}
		
		
		protected function CreationCompleteHandler(event:FlexEvent):void
		{
			mTimer.addEventListener(TimerEvent.TIMER, OnTimer);
			mTimer.start();
			
			OnTimer(null);
		}
		
		private function OnTimer(e:TimerEvent) : void
		{
			MyTimeLabel.text = GetInjuryRemainingTime(TheSoccerPlayer);	
		}
		
		private var mTimer : Timer = new Timer(1000, 0);
		
	]]></fx:Script>
		
	<s:Image x="0" y="0" source="@Embed(source='/Assets/General.swf', symbol='CapDetailInjuredBg')" />
	<s:Group x="0" y="0" width="187">
		<s:layout>
			<s:VerticalLayout gap="6" horizontalAlign="center" />
		</s:layout>
		<s:Group height="53">
			<s:layout>
				<s:HorizontalLayout verticalAlign="middle" gap="10" />
			</s:layout>
			<s:Image source="@Embed(source='/Assets/General.swf', symbol='CapDetailInjuredIcon')" />
			<s:Label text="{resourceManager.getString('main','CapDetailPlayerInjured')}" styleName="whiteBoldBig" />
		</s:Group>
		<s:Label text="{resourceManager.getString('main','CapDetailTimeToRecover')} :" styleName="whiteBoldMedium" />
		<s:Label id="MyTimeLabel" text="" styleName="whiteBoldBig" />
	</s:Group>
		
</s:Group>
