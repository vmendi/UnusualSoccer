<?xml version="1.0" encoding="utf-8"?>
<s:Group xmlns:fx="http://ns.adobe.com/mxml/2009" 
		 xmlns:s="library://ns.adobe.com/flex/spark"
		 xmlns:mx="library://ns.adobe.com/flex/mx"
		 xmlns:GameView="GameView.*"
		 width="400" height="300"
		 creationComplete="CreationCompleteHandler(event)"
		 >
	
	<fx:Script><![CDATA[
		import GameModel.LoginModel;
		import GameModel.MainGameModel;
		
		import HttpService.enum.VALID_NAME;
		
		import mx.binding.utils.BindingUtils;
		import mx.core.FlexGlobals;
		import mx.core.IFlexModule;
		import mx.events.FlexEvent;
		import mx.managers.PopUpManager;
		
		import spark.events.TextOperationEvent;
		
		public static function Show() : void
		{
			var dlg : ChangeNameDialog = new ChangeNameDialog();
			var parent : Sprite = FlexGlobals.topLevelApplication as Sprite;
			
			dlg.moduleFactory = IFlexModule(parent).moduleFactory;
			
			PopUpManager.addPopUp(dlg, parent, true, null);
			PopUpManager.centerPopUp(dlg);
		}
		
		protected function CreationCompleteHandler(event:FlexEvent):void
		{
			mMainGameModel = SoccerClient.GetMainGameModel();
			mLoginModel = mMainGameModel.TheLoginModel; 
			
			BindingUtils.bindSetter(OnIsValidTeamNameLastResult, mLoginModel, ["IsValidTeamNameLastResult"]);
		}
		
		private function OnIsValidTeamNameLastResult(validity : String) : void
		{							
			if (validity == VALID_NAME.VALID)
				SetNameValidity(true, resourceManager.getString('main','LoginNameAvailable'));	
			else if (validity == VALID_NAME.EMPTY)
				SetNameValidity(false, resourceManager.getString('main','LoginEnterName'));	
			else if (validity == VALID_NAME.DUPLICATED)
				SetNameValidity(false, resourceManager.getString('main','LoginNotAvailable'));	
			else if (validity == VALID_NAME.INAPPROPIATE)
				SetNameValidity(false, resourceManager.getString('main','LoginInappropriateName'));
			else if (validity == VALID_NAME.TOO_SHORT)
				SetNameValidity(false, resourceManager.getString('main','LoginNameTooShort'));
			else if (validity == VALID_NAME.WHITE_SPACE_TRIM)
				SetNameValidity(false, resourceManager.getString('main','LoginNameBlank'));
			else if (validity == VALID_NAME.TOO_MANY_WHITESPACES)
				SetNameValidity(false, resourceManager.getString('main','LoginNameBlankSpaces'));
			else
				SetNameValidity(false, resourceManager.getString('main','LoginInvalidName'));
		}
		
		private function SetNameValidity(valid : Boolean, text : String) : void
		{
			MyValidityLabel.text = text;
			mNameValidity = valid;
			
			if (valid)
				MyValidityLabel.setStyle("color", "#0DBF00");
			else
				MyValidityLabel.setStyle("color", "#E26261");
		}
		
		protected function MyTeamNameInput_changeHandler(event:TextOperationEvent):void
		{				
			mLoginModel.IsValidTeamName(MyTeamNameInput.text);
		}
		
		protected function MyButtonNext_clickHandler(event:MouseEvent):void
		{
			mWaitingForNameChange = true;
			
			PopUpManager.removePopUp(this);
		}
		
		[Bindable] private var mMainGameModel : MainGameModel;
		[Bindable] private var mLoginModel : LoginModel;
		
		[Bindable] private var mNameValidity : Boolean = false;
		[Bindable] private var mWaitingForNameChange : Boolean = false;
		
		
	]]></fx:Script>
	
	<fx:Declarations>
		<s:DropShadowFilter id="MyTextDropShadowFilter" angle="270" blurX="1" blurY="1"
							color="0x444444" distance="1"/>
	</fx:Declarations>
		
	<GameView:PopupBackground width="100%" height="100%" />
	
	<s:Group>
		<s:layout>
			<s:VerticalLayout gap="6" horizontalAlign="center"/>
		</s:layout>
		<s:Group>
			<s:Rect id="tbFill" x="0" y="0" width="100%" height="27">
				<s:fill>
					<s:LinearGradient rotation="90">
						<s:GradientEntry alpha="1" color="#fe0001" ratio="0"/>
						<s:GradientEntry alpha="1" color="#8c1304" ratio="1.0"/>
					</s:LinearGradient>
				</s:fill>
			</s:Rect>
			<s:Label id="myStep2Label" x="10" y="0" width="350" height="27"
					 filters="{MyTextDropShadowFilter}" maxDisplayedLines="1"
					 styleName="headerBox"
					 text="{resourceManager.getString('main','Login02EnterName')}"
					 textAlign="start" verticalAlign="middle"></s:Label>
		</s:Group>
		
		<s:Label id="myStep2Txt" x="10" y="35" width="350" styleName="whiteBoldBig"
				 text="{resourceManager.getString('main','Login02EnterNameTxt')}"
				 textAlign="center" verticalAlign="middle"></s:Label>
		
		<s:TextInput id="MyTeamNameInput" x="82" y="97" width="200"
					 change="MyTeamNameInput_changeHandler(event)" maxChars="30"
					 styleName="blackBoldMediumHN" prompt="{LoginModel.GUEST_NAME}"/>
		
		<s:Label id="MyValidityLabel" x="32" y="126" width="300" height="40" color="#0DBF00"
				 styleName="whiteBoldBig" textAlign="center"/>
	</s:Group>
	
	<s:Group>
		<s:BitmapImage fillMode="clip"
					   source="@Embed(source='/Assets/General.swf', symbol='LoginBottomBg')"/>
		<s:Button id="MyButtonNext" x="98" top="4" width="160" height="24"
				  label="{resourceManager.getString('main','Continue')}"
				  click="MyButtonNext_clickHandler(event)" enabled="{mNameValidity}"
				  skinClass="GameView.Skins.ButtonGreySkin"/>
	</s:Group>
	
</s:Group>
